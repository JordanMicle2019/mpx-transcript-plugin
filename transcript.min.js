var words=[],wordsIndex=[],paragraphIndex=[],searchKey="",mediaDuration=null,currentWord=0,wordStausTimer=null,mediaStatus=!1,isScrolling=1,mediaPID=null,currentTime=0;function insertComponents(){$("#transcript-container").html('\n            <div class="transcript-progress-bar">\n                <div class="progress-bar-status">\n                </div>\n                <div class="search-marker-container">\n\n                </div>\n            </div>\n            <div class="transcript-control-bar">\n                <div class="searchbox-container">\n                    <input type="text" class="searchbox" placeholder="Search Transcript..." />\n                    <i class="fa fa-search"></i>\n                </div>\n                <div class="checkbox-container">\n                    <input type="checkbox" class="checkbox-for-scroll" checked/> <label>auto-scroll</label>\n                </div>\n            </div>\n            <div class="transcript-content">\n            </div>\n            <div class="transcript-bottom-bar">\n            </div>\n    ')}function findNearestValue(r){if(wordsIndex.length){var e=wordsIndex.reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e);return wordsIndex.indexOf(e)}return 0}function updateTranscript(){$(".search-marker-container").empty(),$(".transcript-content").empty(),wordsIndex=[];for(var r=$("<p></p>"),e=0,t=words.length;e<t;e++)if(wordsIndex.push(parseInt(words[e][0])),words[e][1]){e&&paragraphIndex.includes(parseInt(words[e][0]))&&($(".transcript-content").append(r),r=$("<p></p>"));var n=$("<span></span>");n.attr("data-ms",words[e][0]),n.attr("id","00_"+words[e][0]),n.addClass("transcript-element"),n.html(words[e][1]),r.append(n)}$(".transcript-content").append(r)}function updateSearch(){$(".search-marker-container").empty(),$("div.transcript-content>p>span").removeClass("marked");for(var r=0,e=words.length;r<e;r++)if(words[r][1]&&searchKey&&words[r][1].toLowerCase().includes(searchKey.toLowerCase())){$("#00_"+words[r][0]).addClass("marked");var t=words[r][0]/mediaDuration*100,n=document.createElement("span");n.className="transcript-search-marker",n.style.cssText="left:"+t+"%",n.setAttribute("data-ms",words[r][0]),document.querySelector(".search-marker-container").appendChild(n)}}function addLoadEvent(r){r.onload=function(){$pdk.bind(r,!0),$pdk.controller.setIFrame(r,!0),words=[],wordsIndex=[],paragraphIndex=[],searchKey="",mediaDuration=null,currentWord=0,currentTime=0,mediaStatus=!1,isScrolling=1,mediaPID=null,insertComponents(),clearInterval(wordStausTimer),$(document).on("click",".transcript-element",function(){clearInterval(wordStausTimer);var r=$(this).data("ms");$pdk.controller.seekTo(r)}),$(document).on("change keyup",".searchbox",function(){var r=$(this).val();r?r!=searchKey&&(searchKey=r,updateSearch()):(searchKey="",updateSearch())}),$(document).on("click",".transcript-progress-bar",function(r){clearInterval(wordStausTimer);var e=$(r.currentTarget),t=e.offset(),n=(r.clientX-t.left)/e.width()*100;$pdk.controller.seekToPercentage(n)}),$(document).on("change",".checkbox-for-scroll",function(){var r=$(this).is(":checked");isScrolling=!!r}),$pdk.controller.addEventListener("OnPlayerLoaded",function(){var r=setInterval(function(){mediaPID&&(clearInterval(r),fetch(`https://ikonik.vo.llnwd.net/gatewaynetwork/timedtext/${mediaPID}.json`).then(r=>r.json()).then(r=>{words=r.words,paragraphIndex=r.paragraphs,updateTranscript()}).catch(r=>{console.error("Error:",r)}))},10)}),$pdk.controller.addEventListener("OnMediaPlaying",function(r){clearInterval(wordStausTimer),currentTime=r.data.currentTimeAggregate,$(".progress-bar-status").css("width",currentTime/mediaDuration*100+"%"),isScrolling&&words[currentWord]&&$(".transcript-content").animate({scrollTop:$("#00_"+words[currentWord][0]).offset().top-$(".transcript-content").offset().top+$(".transcript-content").scrollTop()}),wordStausTimer=setInterval(function(){mediaStatus&&(currentTime+=1,words[currentWord]&&currentTime>=parseInt(words[currentWord][0])&&($("#00_"+words[currentWord][0]).addClass("current"),++currentWord>1&&$("#00_"+words[currentWord-2][0]).hasClass("current")&&$("#00_"+words[currentWord-2][0]).removeClass("current")))},1)}),$pdk.controller.addEventListener("OnMediaUnpause",function(){mediaStatus=!0}),$pdk.controller.addEventListener("OnMediaPause",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaSeekStart",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaSeekComplete",function(r){mediaStatus=!0,currentWord&&$("#00_"+words[currentWord-1][0]).hasClass("current")&&$("#00_"+words[currentWord-1][0]).removeClass("current");var e=r.data.end.currentTimeAggregate;currentWord=findNearestValue(e),currentTime=r.data.end.currentTimeAggregate}),$pdk.controller.addEventListener("OnMediaBufferStart",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaBufferComplete",function(){mediaStatus=!0}),$pdk.controller.addEventListener("OnMediaError",function(){clearInterval(wordStausTimer),mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaStart",function(r){mediaStatus=!0,mediaDuration||(mediaDuration=r.data.endTime),currentWord=0}),$pdk.controller.addEventListener("OnReleasePreview",function(r){mediaDuration=r.data.duration,mediaPID=r.data.mediaPID}),$pdk.controller.addEventListener("OnMediaEnd",function(){clearInterval(wordStausTimer),$(".progress-bar-status").css("width","0%"),currentWord&&$("#00_"+words[currentWord-1][0]).hasClass("current")&&$("#00_"+words[currentWord-1][0]).removeClass("current")})},r.setAttribute("data-add",!0)}var initialFrame=document.getElementById("player-iframe");addLoadEvent(initialFrame),$("#root").bind("DOMSubtreeModified",function(){var r=document.getElementById("root").querySelector("#player-iframe");if(r){if(r.getAttribute("data-add"))return;addLoadEvent(r)}});