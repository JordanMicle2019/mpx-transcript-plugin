var words=[],wordsIndex=[],paragraphIndex=[],searchKey="",mediaDuration=null,currentWord=0,wordStausTimer=null,mediaStatus=!1,isScrolling=!0,mediaPID=null,currentTime=0,totalSearchWords=0,currentSearchWordsIndex=0;function insertComponents(){$("#transcript-container").html('\n            <div class="transcript-progress-bar">\n                <div class="progress-bar-status">\n                </div>\n                <div class="search-marker-container">\n\n                </div>\n            </div>\n            <div class="transcript-control-bar">\n                <div class="searchbox-container">\n                    <input type="text" class="searchbox" placeholder="Search Transcript..." />\n                    <div id="search_focus">\n                      <span class="pad-10" id="search_status">0/0</span>\n                      <span class="splitter"></span>\n                      <i class="fa fa-angle-up pad-10 disabled" id="search_up"></i>\n                      <i class="fa fa-angle-down pad-10 disabled" id="search_down"></i>\n                      <i class="fa fa-times pad-10" id="close_search_focus"></i>\n                    </div>\n                </div>\n                <div class="checkbox-container">\n                    <input type="checkbox" class="checkbox-for-scroll" checked/> <label>auto-scroll</label>\n                </div>\n            </div>\n            <div class="transcript-content">\n            </div>\n            <div class="transcript-bottom-bar">\n            </div>\n    ')}function findNearestValue(e){if(wordsIndex.length){var r=wordsIndex.reduce((r,t)=>Math.abs(t-e)<Math.abs(r-e)?t:r);return wordsIndex.indexOf(r)}return 0}function updateTranscript(){$(".search-marker-container").empty(),$(".transcript-content").empty(),wordsIndex=[];for(var e=$("<p></p>"),r=0,t=words.length;r<t;r++)if(wordsIndex.push(parseInt(words[r][0])),words[r][1]){r&&paragraphIndex.includes(parseInt(words[r][0]))&&($(".transcript-content").append(e),e=$("<p></p>"));var a=$("<span></span>");a.attr("data-ms",words[r][0]),a.attr("id","00_"+words[r][0]),a.addClass("transcript-element"),a.html(words[r][1]),e.append(a)}$(".transcript-content").append(e)}function updateSearch(){$(".search-marker-container").empty(),$("div.transcript-content>p>span").removeClass("marked"),totalSearchWords=0,currentSearchWordsIndex=0;for(var e=0,r=words.length;e<r;e++)if(words[e][1]&&searchKey&&words[e][1].toLowerCase().includes(searchKey.toLowerCase())){$("#00_"+words[e][0]).addClass("marked");var t=words[e][0]/mediaDuration*100,a=document.createElement("span");a.className="transcript-search-marker",a.style.cssText="left:"+t+"%",a.setAttribute("data-ms",words[e][0]),document.querySelector(".search-marker-container").appendChild(a),totalSearchWords++}updateSearchComponent()}function updateSearchComponent(){$("div.transcript-content>p>span").removeClass("active"),$("div.search-marker-container>span.transcript-search-marker").removeClass("active");var e=totalSearchWords?currentSearchWordsIndex+1+"/"+totalSearchWords:"0/"+totalSearchWords;$("#search_status").html(e),totalSearchWords?($("div.transcript-content>p>span.marked")[currentSearchWordsIndex].classList.add("active"),$("div.search-marker-container>span.transcript-search-marker")[currentSearchWordsIndex].classList.add("active"),$(".transcript-content").animate({scrollTop:$("div.transcript-content>p>span.marked.active").offset().top-$(".transcript-content").offset().top+$(".transcript-content").scrollTop()},100),0==currentSearchWordsIndex?($("#search_up").addClass("disabled"),$("#search_down").removeClass("disabled")):currentSearchWordsIndex==totalSearchWords-1?($("#search_up").removeClass("disabled"),$("#search_down").addClass("disabled")):($("#search_up").removeClass("disabled"),$("#search_down").removeClass("disabled"))):($("#search_up").addClass("disabled"),$("#search_down").addClass("disabled"))}function connectIframeMPX(e){$pdk.bind(e,!0),$pdk.controller.setIFrame(e,!0),words=[],wordsIndex=[],paragraphIndex=[],searchKey="",mediaDuration=null,currentWord=0,currentTime=0,mediaStatus=!1,isScrolling=!0,mediaPID=null,totalSearchWords=0,currentSearchWordsIndex=0,insertComponents(),clearInterval(wordStausTimer),$pdk.controller.addEventListener("OnPlayerLoaded",function(){var e=setInterval(function(){mediaPID&&(clearInterval(e),fetch(`https://ikonik.vo.llnwd.net/gatewaynetwork/timedtext/${mediaPID}.json`).then(e=>e.json()).then(e=>{words=e.words,paragraphIndex=e.paragraphs,updateTranscript()}).catch(e=>{console.error("Error:",e)}))},10)}),$pdk.controller.addEventListener("OnMediaPlaying",function(e){clearInterval(wordStausTimer),currentTime=e.data.currentTimeAggregate,$(".progress-bar-status").css("width",currentTime/mediaDuration*100+"%"),isScrolling&&words[currentWord]&&$(".transcript-content").animate({scrollTop:$("#00_"+words[currentWord][0]).offset().top-$(".transcript-content").offset().top+$(".transcript-content").scrollTop()},100),wordStausTimer=setInterval(function(){mediaStatus&&(currentTime+=1,words[currentWord]&&currentTime>=parseInt(words[currentWord][0])&&($("#00_"+words[currentWord][0]).addClass("current"),++currentWord>1&&$("#00_"+words[currentWord-2][0]).hasClass("current")&&$("#00_"+words[currentWord-2][0]).removeClass("current")))},1)}),$pdk.controller.addEventListener("OnMediaUnpause",function(){mediaStatus=!0}),$pdk.controller.addEventListener("OnMediaPause",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaSeekStart",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaSeekComplete",function(e){mediaStatus=!0,currentWord&&$("#00_"+words[currentWord-1][0]).hasClass("current")&&$("#00_"+words[currentWord-1][0]).removeClass("current");var r=e.data.end.currentTimeAggregate;currentWord=findNearestValue(r),currentTime=e.data.end.currentTimeAggregate}),$pdk.controller.addEventListener("OnMediaBufferStart",function(){mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaBufferComplete",function(){mediaStatus=!0}),$pdk.controller.addEventListener("OnMediaError",function(){clearInterval(wordStausTimer),mediaStatus=!1}),$pdk.controller.addEventListener("OnMediaStart",function(e){mediaStatus=!0,mediaDuration||(mediaDuration=e.data.endTime),currentWord=0}),$pdk.controller.addEventListener("OnReleasePreview",function(e){mediaDuration=e.data.duration,mediaPID=e.data.mediaPID}),$pdk.controller.addEventListener("OnMediaEnd",function(){clearInterval(wordStausTimer),$(".progress-bar-status").css("width","0%"),currentWord&&$("#00_"+words[currentWord-1][0]).hasClass("current")&&$("#00_"+words[currentWord-1][0]).removeClass("current")}),e.setAttribute("data-add",!0)}function addLoadEvent(e){e.onload=function(){connectIframeMPX(e)}}$pdk.controller.addEventListener("OnPlayerLoaded",function(){var e=document.getElementById("player-iframe");e.getAttribute("data-add")||connectIframeMPX(e)});var initialFrame=document.getElementById("player-iframe");initialFrame.getAttribute("data-add")||addLoadEvent(initialFrame),$(document).on("click",".transcript-element",function(){clearInterval(wordStausTimer);var e=$(this).data("ms");$pdk.controller.seekTo(e)}),$(document).on("focus",".searchbox",function(){$("#search_focus").show()}),$(document).on("click","#search_up",function(){currentSearchWordsIndex&&currentSearchWordsIndex--,updateSearchComponent()}),$(document).on("click","#search_down",function(){currentSearchWordsIndex<totalSearchWords-1&&(currentSearchWordsIndex+=1,updateSearchComponent())}),$(document).on("click","#close_search_focus",function(){$("#search_focus").hide(),$(".searchbox").val(""),searchKey="",updateSearch()}),$(document).on("change keyup",".searchbox",function(){var e=$(this).val();e?e!=searchKey&&(searchKey=e,updateSearch()):(searchKey="",updateSearch())}),$(document).on("click",".transcript-progress-bar",function(e){clearInterval(wordStausTimer);var r=$(e.currentTarget),t=r.offset(),a=(e.clientX-t.left)/r.width()*100;$pdk.controller.seekToPercentage(a)}),$(document).on("change",".checkbox-for-scroll",function(){var e=$(this).is(":checked");isScrolling=!!e}),$("#root").bind("DOMSubtreeModified",function(){var e=document.getElementById("root").querySelector("#player-iframe");if(e){if(e.getAttribute("data-add"))return;addLoadEvent(e)}});